<#    
Script Name:			VMware CVE-2021-22045.ps1
Description:			Intern service script for Christian Kremer 
Data:					15/Jul/2022
Version:				1.0
Author:					Christian Kremer
Email:					christian@kremer.systems

CVE-2021-22045
https://kb.vmware.com/s/article/87249


#> 
write-host "Specify vCenter FQDN" -ForegroundColor Green 
$vCenter= Read-Host "Enter your vCenter FQDN" 


write-host "Connecting to $vCenter" -ForegroundColor Green
Connect-VIServer $vCenter

 
function Show-CustomMenu
{
    param (
        [string]$menuname = 'CVE-2021-22045'
    )
    Clear-Host
    Write-Host "================ $menuname ================"
    
    Write-Host "1: Choose '1' List the virtual machines that have a CD-ROM/DVD connected"
    Write-Host "2: Choose '2' To remove and disconnect an attached CD-ROM/DVD device"
    Write-Host "Q: Choose 'Q' Exit."
   
}


Show-CustomMenu –menuname 'CVE-2021-22045'

$auswahl = Read-Host "Enter the option"
# Optionen wählen
switch ($auswahl){
     '1' {Get-VM | Get-CDDrive | Where {$_.extensiondata.connectable.connected -eq $true} | Select Parent}
     '2' {Get-VM | Get-CDDrive | Where {$_.extensiondata.connectable.connected -eq $true} | Set-CDDrive -NoMedia -confirm:$false}
     'q' {exit}
 }